<!DOCTYPE html>
<html>
<head>
  <title>Edit Page - Memepedia</title>
  <style>
    body { font-family: sans-serif; display: flex; }
    #content { flex: 1; padding: 10px; }
    textarea { width: 100%; height: 70vh; font-family: monospace; }
    button { margin-top: 10px; padding: 6px 12px; }
  </style>
</head>
<body>
  <div id="content">
    <h1>Editing: <span id="pageName"></span></h1>
    <textarea id="pageContent"></textarea>
    <br>
    <button id="saveBtn">Save Edit</button>
  </div>

  <script>
    const webhookURL = "https://discord.com/api/webhooks/1416905580035182702/9YTThtpOtgXA07J3GB9mdtmVPLz8L-gr-bBMp_daM6uy0msS5jGO0YdqjQTyjc7Q4lKy"; // put your webhook here
    let pageName = new URLSearchParams(window.location.search).get("page");

    // If no page param â†’ prompt for one
    if (!pageName) {
      pageName = prompt("Enter a name for your new article:", "");
      if (!pageName) pageName = "Untitled";
      const newURL = `${window.location.pathname}?page=${encodeURIComponent(pageName)}`;
      window.history.replaceState(null, "", newURL);
    }

    document.getElementById("pageName").textContent = pageName;

    // Try to load existing page HTML
    fetch(`projects/wiki/pages/${pageName}.html`)
      .then(res => {
        if (!res.ok) throw new Error("Page not found");
        return res.text();
      })
      .then(html => {
        document.getElementById("pageContent").value = html;
      })
      .catch(() => {
        // Leave empty if page doesn't exist
        document.getElementById("pageContent").value = "";
      });

    // Save button sends edit to Discord webhook
    document.getElementById("saveBtn").addEventListener("click", () => {
      const content = document.getElementById("pageContent").value;

      const payload = {
        username: "Memepedia Edit Bot",
        embeds: [{
          title: `Edit Request for ${pageName}.html`,
          description: "New content submitted:",
          color: 3447003,
          fields: [
            { name: "Page", value: pageName },
            { name: "HTML Content", value: "```html\n" + content.substring(0, 1900) + "\n```" }
          ]
        }]
      };

      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      }).then(res => {
        if (res.ok) {
          alert("Edit sent to Discord for approval!");
        } else {
          alert("Failed to send edit.");
        }
      }).catch(err => alert("Error: " + err));
    });
  </script>
</body>
</html>
