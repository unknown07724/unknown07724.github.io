<!DOCTYPE html>
<html>
<head>
  <title>Edit Page - Memepedia</title>
  <link rel="icon" href="favicon.png">
  <style>
    #searchResults li {
  padding: 6px 10px;
  background: #ddd;
  margin-bottom: 2px;
  cursor: pointer;
  border-radius: 4px;
}

#searchResults li:hover {
  background: #ccc;
}

    body { font-family: sans-serif; display: flex; margin:0; height:100vh; }
    #sidebar { width: 250px; background: #eee; padding: 15px; box-sizing: border-box; overflow-y: auto; }
    #sidebar h2 { margin-top: 0; }
    #sidebar a, #sidebar button { display: block; padding: 8px; margin: 5px 0; text-decoration: none; background: #ddd; border: none; border-radius: 5px; color: black; cursor: pointer; }
    #sidebar a:hover, #sidebar button:hover { background: #ccc; }
    #content { flex: 1; padding: 15px; overflow-y: auto; }
    textarea { width: 100%; height: 60vh; font-family: monospace; }
    button { margin-top: 10px; padding: 6px 12px; }
    #elementPlacer button { margin: 2px; }
    #symbolDropdown { margin-left: 5px; }
  </style>
</head>
<body>
 <div id="sidebar">
   <img src="logo.svg" alt="Memepedia logo" width="175" height="175">
   <a href="main.html">Main page</a>
   <a href="edit.html">Create a page</a>
   <a href="upload.html">Upload Image</a>
   <a href="random.html" id="randomPageLink">Random Page</a>
 </div>

 <div id="content">
<input type="text" id="searchInput" placeholder="Search Memepedia..." style="position:absolute;top:0;right:0;width:200px;padding:10px;font-size:16px;">
<ul id="searchResults" style="list-style: none; padding-left: 0; margin-top: 0;"></ul>
   <h1>Editing <span id="pageName"></span></h1>
   <p>If you're unsure what "HTML" is, you should run off and learn about it before editing.</p>

   <!-- Element Placer Buttons -->
   <div id="elementPlacer" style="margin-bottom:10px;">
     <button onclick="insertTag(`<p>Example paragraph</p>`)">P</button>
     <button onclick="insertTag(`<h2>Example header</h2>`)">H2</button>
     <button onclick="insertTag(`<ul><li>Item 1</li></ul>`)">•</button>
     <button onclick="insertTag(`<ol><li>Step 1</li></ol>`)">1.</button>
     <button onclick="insertTag(`<blockquote>Example quote</blockquote>`)">Quote</button>
     <button onclick="insertTag(`<img src='/projects/wiki/logo.svg' alt='example'>`)">Image</button>
     <button onclick="insertTag(`<a href='memepedia.html'>link text</a>`)">⫘</button>
     <button onclick="insertTag(`<strong>Bold text</strong>`)"><strong>B</strong></button>
     <button onclick="insertTag(`<i>Italic text</i>`)"><i>I</i></button>
     <button onclick="insertTag(`<code>const x = 1;</code>`)">&lt;/&gt;</button>
     <button onclick="insertTag(`<var>π</var>`)">&pi;</button>

     <!-- Symbols dropdown -->
     <select id="symbolDropdown" onchange="insertSymbol(this.value)">
  <option value="">Symbols...</option>

<optgroup label="Lowercase greek Letters">
<option value="α">&alpha;</option>
<option value="β">&beta;</option>
<option value="γ">&gamma;</option>
<option value="δ">&delta;</option>
<option value="ε">&epsilon;</option>
<option value="ζ">&zeta;</option>
<option value="η">&eta;</option>
<option value="θ">&theta;</option>
<option value="ι">&iota;</option>
<option value="κ">&kappa;</option>
<option value="λ">&lambda;</option>
<option value="μ">&mu;</option>
<option value="ν">&nu;</option>
<option value="ξ">&xi;</option>
<option value="ο">&omicron;</option>
<option value="ρ">&rho;</option>
<option value="σ">&sigma;</option>
<option value="τ">&tau;</option>
<option value="υ">&upsilon;</option>
<option value="φ">&phi;</option>
<option value="χ">&chi;</option>
<option value="ψ">&psi;</option>
<option value="ω">&omega;</option>
</optgroup>
<optgroup label="Uppercase greek Letters">       
<option value="Α">&Alpha;</option>
<option value="Β">&Beta;</option>
<option value="Γ">&Gamma;</option>
<option value="Δ">&Delta;</option>
<option value="Ε">&Epsilon;</option>
<option value="Ζ">&Zeta;</option>
<option value="Η">&Eta;</option>
<option value="Θ">&Theta;</option>
<option value="Ι">&Iota;</option>
<option value="Κ">&Kappa;</option>
<option value="Λ">&Lambda;</option>
<option value="Μ">&Mu;</option>
<option value="Ν">&Nu;</option>
<option value="Ξ">&Xi;</option>
<option value="Ο">&Omicron;</option>
<option value="Π">&Pi;</option>
<option value="Ρ">&Rho;</option>
<option value="Σ">&Sigma;</option>
<option value="Τ">&Tau;</option>
<option value="Υ">&Upsilon;</option>
<option value="Φ">&Phi;</option>
<option value="Χ">&Chi;</option>
<option value="Ψ">&Psi;</option>
<option value="Ω">&Omega;</option>
</optgroup>
<optgroup label="Hebrew Letters">
  <!-- Standard letters -->
  <option value="א">א</option>
  <option value="ב">ב</option>
  <option value="ג">ג</option>
  <option value="ד">ד</option>
  <option value="ה">ה</option>
  <option value="ו">ו</option>
  <option value="ז">ז</option>
  <option value="ח">ח</option>
  <option value="ט">ט</option>
  <option value="י">י</option>
  <option value="כ">כ</option>
  <option value="ל">ל</option>
  <option value="מ">מ</option>
  <option value="נ">נ</option>
  <option value="ס">ס</option>
  <option value="ע">ע</option>
  <option value="פ">פ</option>
  <option value="צ">צ</option>
  <option value="ק">ק</option>
  <option value="ר">ר</option>
  <option value="ש">ש</option>
  <option value="ת">ת</option>

  <!-- Final forms (sofit letters) -->
  <option value="ך">ך</option>
  <option value="ם">ם</option>
  <option value="ן">ן</option>
  <option value="ף">ף</option>
  <option value="ץ">ץ</option>
</optgroup>


<optgroup label="Math Symbols">
<option value="π">&pi;</option>
<option value="∞">&infin;</option>
<option value="±">&plusmn;</option>
<option value="×">&times;</option>
<option value="÷">&divide;</option>
<option value="≠">&ne;</option>
<option value="≈">&asymp;</option>
<option value="≤">&le;</option>
<option value="≥">&ge;</option>
<option value="∞">&infin;</option>
<option value="√">&radic;</option>
<option value="∑">&sum;</option>
<option value="∏">&prod;</option>
<option value="∫">&int;</option>
</optgroup>
<!-- Uppercase European Latin -->
<optgroup label="Uppercase European Latin">
  <!-- German / Nordic / Special -->
  <option value="ẞ">ẞ</option>
  <option value="Þ">&THORN;</option>
  <option value="Ð">&ETH;</option>
  <option value="Æ">&AElig;</option>
  <option value="Ø">&Oslash;</option>
  <option value="Å">&Aring;</option>

  <!-- Western European accents -->
  <option value="À">&Agrave;</option>
  <option value="Á">&Aacute;</option>
  <option value="Â">&Acirc;</option>
  <option value="Ã">&Atilde;</option>
  <option value="Ä">&Auml;</option>
  <option value="Ç">&Ccedil;</option>
  <option value="È">&Egrave;</option>
  <option value="É">&Eacute;</option>
  <option value="Ê">&Ecirc;</option>
  <option value="Ë">&Euml;</option>
  <option value="Ì">&Igrave;</option>
  <option value="Í">&Iacute;</option>
  <option value="Î">&Icirc;</option>
  <option value="Ï">&Iuml;</option>
  <option value="Ñ">&Ntilde;</option>
  <option value="Ò">&Ograve;</option>
  <option value="Ó">&Oacute;</option>
  <option value="Ô">&Ocirc;</option>
  <option value="Õ">&Otilde;</option>
  <option value="Ö">&Ouml;</option>
  <option value="Ù">&Ugrave;</option>
  <option value="Ú">&Uacute;</option>
  <option value="Û">&Ucirc;</option>
  <option value="Ü">&Uuml;</option>
  <option value="Ý">&Yacute;</option>
  <option value="Ÿ">&Yuml;</option>
  <option value="Œ">&Oelig;</option>
</optgroup>

<!-- Lowercase European Latin -->
<optgroup label="Lowercase European Latin">
  <!-- German / Nordic / Special -->
  <option value="ß">&szlig;</option>
  <option value="þ">&thorn;</option>
  <option value="ð">&eth;</option>
  <option value="æ">&aelig;</option>
  <option value="ø">&oslash;</option>
  <option value="å">&aring;</option>

  <!-- Western European accents -->
  <option value="à">&agrave;</option>
  <option value="á">&aacute;</option>
  <option value="â">&acirc;</option>
  <option value="ã">&atilde;</option>
  <option value="ä">&auml;</option>
  <option value="ç">&ccedil;</option>
  <option value="è">&egrave;</option>
  <option value="é">&eacute;</option>
  <option value="ê">&ecirc;</option>
  <option value="ë">&euml;</option>
  <option value="ì">&igrave;</option>
  <option value="í">&iacute;</option>
  <option value="î">&icirc;</option>
  <option value="ï">&iuml;</option>
  <option value="ñ">&ntilde;</option>
  <option value="ò">&ograve;</option>
  <option value="ó">&oacute;</option>
  <option value="ô">&ocirc;</option>
  <option value="õ">&otilde;</option>
  <option value="ö">&ouml;</option>
  <option value="ù">&ugrave;</option>
  <option value="ú">&uacute;</option>
  <option value="û">&ucirc;</option>
  <option value="ü">&uuml;</option>
  <option value="ý">&yacute;</option>
  <option value="ÿ">&yuml;</option>
  <option value="œ">&oelig;</option>
</optgroup>

</select>
     <select id="symbolDropdown" onchange="insertSymbol(this.value)">
        <option value="<div class='mt'>This page has too few jokes and could use more humorous content.</div>">Too Few Jokes</option>
  <option value="<div class='mt'>This page needs more sources.</div>">Needs Sources</option>
  <option value="<div class='mt'>This page is outdated.</div>">Outdated</option>
       </select>
   </div>
<!-- Add this right above the textarea -->
<p id="charCount">0 B</p>
<textarea id="pageContent"></textarea>

   <textarea id="pageContent"></textarea>
   <br>
   <button id="saveBtn">Save Edit</button>
 </div>

 <script>
   const webhookURL = "https://discord.com/api/webhooks/1416905580035182702/9YTThtpOtgXA07J3GB9mdtmVPLz8L-gr-bBMp_daM6uy0msS5jGO0YdqjQTyjc7Q4lKy";
   let pageName = new URLSearchParams(window.location.search).get("page");

   if (!pageName) {
     pageName = prompt("Enter a name for your new article:", "");
     if (!pageName) pageName = "Untitled";
     const newURL = `${window.location.pathname}?page=${encodeURIComponent(pageName)}`;
     window.history.replaceState(null, "", newURL);
   }

   document.getElementById("pageName").textContent = pageName;

   const exampleHTML = `<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/projects/wiki/styles.css">
  </head>
  <body>
<!--do not edit what is above since that will irreversibly give you (and the site) cancer-->

<h1>this is a blah header</h1>
<p>Blah blah blah (put stuff here)</p>
<p>Blah blah blah <a href="memepedia.html">change href and name</a></p>
<p><strong>this is thick blah</strong></p>
<p><i>this is italic blah</i></p>
<p><em>this is emphasis blah</em></p>
<p><code>const blah = blah</code></p>

<ul>
  <li>first blah item</li>
  <li>second blah item</li>
  <li>third blah item</li>
</ul>
<p>Ordered list blah:</p>
<ol>
  <li>first step blah</li>
  <li>second step blah</li>
  <li>third step blah</li>
</ol>

<p>Example image blah:</p>
<img src="/projects/wiki/logo.svg" alt="example">
<blockquote>
This is a blah quote. Perfect for meme sayings or other blah.
</blockquote>

<p>Line one blah<br>Line two blah<br>Line three blah</p>
<hr>
<p>blah after break</p>

<!--do not edit what is below since that will irreversibly fuck up the page-->
  </body>
</html>
`;

   fetch(`/projects/wiki/pages/${pageName}.html`)
     .then(res => res.ok ? res.text() : Promise.reject())
     .then(html => {
       document.getElementById("pageContent").value = html;
     })
     .catch(() => {
       document.getElementById("pageContent").value = exampleHTML;
     });

   document.getElementById("saveBtn").addEventListener("click", () => {
     const content = document.getElementById("pageContent").value;
     const payload = {
       username: "Memepedia Edit Bot",
       embeds: [{
         title: `Edit Request for ${pageName}.html`,
         description: "New content submitted:",
         color: 3447003,
         fields: [
           { name: "Page", value: pageName },
           { name: "HTML Content", value: "```html\n" + content.substring(0, 1900) + "\n```" }
         ]
       }]
     };

     fetch(webhookURL, {
       method: "POST",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify(payload)
     }).then(res => {
       alert(res.ok ? "Edit sent to Discord for approval!" : "Failed to send edit.");
     }).catch(err => alert("Error: " + err));
   });

   function insertTag(tag) {
     const textarea = document.getElementById('pageContent');
     const start = textarea.selectionStart;
     const end = textarea.selectionEnd;
     const before = textarea.value.substring(0, start);
     const after = textarea.value.substring(end);
     textarea.value = before + tag + after;
     textarea.selectionStart = textarea.selectionEnd = start + tag.length;
     textarea.focus();
   }

   function insertSymbol(symbol) {
     if (!symbol) return;
     const textarea = document.getElementById('pageContent');
     const start = textarea.selectionStart;
     const end = textarea.selectionEnd;
     textarea.value = textarea.value.slice(0, start) + symbol + textarea.value.slice(end);
     textarea.selectionStart = textarea.selectionEnd = start + symbol.length;
     textarea.focus();
     document.getElementById('symbolDropdown').value = '';
   }
   const searchResults = document.getElementById('searchResults');
   
let articles = [];

fetch('/projects/wiki/articles.json')
  .then(res => res.json())
  .then(data => articles = data)
  .catch(err => console.error("Failed to load articles.json", err));


searchInput.addEventListener('input', () => {
  const query = searchInput.value.toLowerCase();
  searchResults.innerHTML = ''; // clear old results

  if (!query) return;

  const matches = articles.filter(a => a.title.toLowerCase().includes(query));
  
  matches.forEach(match => {
    const li = document.createElement('li');
    li.textContent = match.title;
    li.addEventListener('click', () => {
      window.location.href = `page.html?page=${encodeURIComponent(match.title)}`;
    });
    searchResults.appendChild(li);
  });
});
const textarea = document.getElementById('pageContent');
const charCount = document.getElementById('charCount');

function formatSize(bytes) {
  if (bytes < 1024) return `${bytes} B`;
  if (bytes < 1024*1024) return `${(bytes/1024).toFixed(2)} KiB`;
  return `${(bytes/(1024*1024)).toFixed(2)} MiB`;
}

function updateCharCount() {
  const bytes = new TextEncoder().encode(textarea.value).length;
  charCount.textContent = `${formatSize(bytes)} (${textarea.value.length} chars)`;
  charCount.style.color = bytes > 1900 ? 'red' : 'black';
}

// update counter initially
updateCharCount();

// update counter on input
textarea.addEventListener('input', updateCharCount);

 </script>
</body>
</html>
