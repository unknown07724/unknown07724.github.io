<!DOCTYPE html>
<html>
<head>
  <title>Edit Page - Memepedia</title>
  <style>
    body { font-family: sans-serif; display: flex; margin:0; height:100vh; }
    #sidebar { width: 250px; background: #eee; padding: 15px; box-sizing: border-box; overflow-y: auto; }
    #sidebar h2 { margin-top: 0; }
    #sidebar a, #sidebar button { display: block; padding: 8px; margin: 5px 0; text-decoration: none; background: #ddd; border: none; border-radius: 5px; color: black; cursor: pointer; }
    #sidebar a:hover, #sidebar button:hover { background: #ccc; }
    #content { flex: 1; padding: 15px; overflow-y: auto; }
    textarea { width: 100%; height: 60vh; font-family: monospace; }
    button { margin-top: 10px; padding: 6px 12px; }
    #elementPlacer button { margin: 2px; }
    #symbolDropdown { margin-left: 5px; }
  </style>
</head>
<body>
 <div id="sidebar">
   <img src="logo.svg" alt="Memepedia logo" width="175" height="175">
   <a href="index.html">Main page</a>
   <a href="edit.html">Create a page</a>
 </div>

 <div id="content">
   <h1>Editing <span id="pageName"></span></h1>
   <p>If you're unsure what "HTML" is, you should run off and learn about it before editing.</p>

   <!-- Element Placer Buttons -->
   <div id="elementPlacer" style="margin-bottom:10px;">
     <button onclick="insertTag(`<p>Example paragraph</p>`)">P</button>
     <button onclick="insertTag(`<h2>Example header</h2>`)">H2</button>
     <button onclick="insertTag(`<ul><li>Item 1</li></ul>`)">•</button>
     <button onclick="insertTag(`<ol><li>Step 1</li></ol>`)">1.</button>
     <button onclick="insertTag(`<blockquote>Example quote</blockquote>`)">Quote</button>
     <button onclick="insertTag(`<img src='/projects/wiki/logo.svg' alt='example'>`)">Image</button>
     <button onclick="insertTag(`<a href='memepedia.html'>link text</a>`)">⫘</button>
     <button onclick="insertTag(`<strong>Bold text</strong>`)"><strong>B</strong></button>
     <button onclick="insertTag(`<i>Italic text</i>`)"><i>I</i></button>
     <button onclick="insertTag(`<code>const x = 1;</code>`)">&lt;/&gt;</button>
     <button onclick="insertTag(`<var>π</var>`)">&pi;</button>

     <!-- Symbols dropdown -->
     <select id="symbolDropdown" onchange="insertSymbol(this.value)">
       <option value="">Symbols...</option>
       <option value="π">&pi;</option>
       <option value="λ">&lambda;</option>
       <option value="θ">&theta;</option>
       <option value="∞">&infin;</option>
       <option value="±">&plusmn;</option>
     </select>
   </div>

   <textarea id="pageContent"></textarea>
   <br>
   <button id="saveBtn">Save Edit</button>
 </div>

 <script>
   const webhookURL = "https://discord.com/api/webhooks/1416905580035182702/9YTThtpOtgXA07J3GB9mdtmVPLz8L-gr-bBMp_daM6uy0msS5jGO0YdqjQTyjc7Q4lKy";
   let pageName = new URLSearchParams(window.location.search).get("page");

   if (!pageName) {
     pageName = prompt("Enter a name for your new article:", "");
     if (!pageName) pageName = "Untitled";
     const newURL = `${window.location.pathname}?page=${encodeURIComponent(pageName)}`;
     window.history.replaceState(null, "", newURL);
   }

   document.getElementById("pageName").textContent = pageName;

   const exampleHTML = `<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/projects/wiki/styles.css">
  </head>
  <body>
<!--do not edit what is above since that will irreversibly give you (and the site) cancer-->

<h1>this is a blah header</h1>
<p>Blah blah blah (put stuff here)</p>
<p>Blah blah blah <a href="memepedia.html">change href and name</a></p>
<p><strong>this is thick blah</strong></p>
<p><i>this is italic blah</i></p>
<p><em>this is emphasis blah</em></p>
<p><code>const blah = blah</code></p>

<ul>
  <li>first blah item</li>
  <li>second blah item</li>
  <li>third blah item</li>
</ul>
<p>Ordered list blah:</p>
<ol>
  <li>first step blah</li>
  <li>second step blah</li>
  <li>third step blah</li>
</ol>

<p>Example image blah:</p>
<img src="/projects/wiki/logo.svg" alt="example">
<blockquote>
This is a blah quote. Perfect for meme sayings or other blah.
</blockquote>

<p>Line one blah<br>Line two blah<br>Line three blah</p>
<hr>
<p>blah after break</p>

<!--do not edit what is below since that will irreversibly fuck up the page-->
  </body>
</html>
`;

   fetch(`/projects/wiki/pages/${pageName}.html`)
     .then(res => res.ok ? res.text() : Promise.reject())
     .then(html => {
       document.getElementById("pageContent").value = html;
     })
     .catch(() => {
       document.getElementById("pageContent").value = exampleHTML;
     });

   document.getElementById("saveBtn").addEventListener("click", () => {
     const content = document.getElementById("pageContent").value;
     const payload = {
       username: "Memepedia Edit Bot",
       embeds: [{
         title: `Edit Request for ${pageName}.html`,
         description: "New content submitted:",
         color: 3447003,
         fields: [
           { name: "Page", value: pageName },
           { name: "HTML Content", value: "```html\n" + content.substring(0, 1900) + "\n```" }
         ]
       }]
     };

     fetch(webhookURL, {
       method: "POST",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify(payload)
     }).then(res => {
       alert(res.ok ? "Edit sent to Discord for approval!" : "Failed to send edit.");
     }).catch(err => alert("Error: " + err));
   });

   function insertTag(tag) {
     const textarea = document.getElementById('pageContent');
     const start = textarea.selectionStart;
     const end = textarea.selectionEnd;
     const before = textarea.value.substring(0, start);
     const after = textarea.value.substring(end);
     textarea.value = before + tag + after;
     textarea.selectionStart = textarea.selectionEnd = start + tag.length;
     textarea.focus();
   }

   function insertSymbol(symbol) {
     if (!symbol) return;
     const textarea = document.getElementById('pageContent');
     const start = textarea.selectionStart;
     const end = textarea.selectionEnd;
     textarea.value = textarea.value.slice(0, start) + symbol + textarea.value.slice(end);
     textarea.selectionStart = textarea.selectionEnd = start + symbol.length;
     textarea.focus();
     document.getElementById('symbolDropdown').value = '';
   }
 </script>
</body>
</html>
