<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="memes and other garbage">
  <meta name="keywords" content="website, memes">
  <meta name="author" content="Unknown07724">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png">
  <link rel="stylesheet" href="/styles/main.css">
  <title>Project List - by Unknown07724</title>
  <style>
    /* Gallery CSS */
   /* Gallery container */
#projects-list.gallery {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  padding: 10px 0;
}

/* Each project card */
.gallery-item {
  border-radius: 12px;
  flex: 1 1 calc(25% - 20px);
  min-width: 220px;
  max-width: 300px;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s, border-color 0.3s;
  cursor: pointer;
}

/* Hover effect */
.gallery-item:hover {
  transform: translateY(-5px);
}

/* Inner box for content */
.gallery-box {
  padding: 15px;
}

/* Titles */
.gallery-box h4 {
  margin: 0 0 10px 0;
  font-size: 1.1em;
}

/* Descriptions */
.gallery-box p {
  font-size: 0.9em;
  line-height: 1.2em;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Author label */
.gallery-box span {
  display: block;
  margin-top: 8px;
  font-size: 0.8em;
}

/* Dark mode */
@media screen and (prefers-color-scheme: dark) {
  .gallery-item {
    background-color: #282828;
    border: 2px solid #334BFF;
    color: white;
  }
  .gallery-item:hover {
    box-shadow: 0 8px 20px rgba(51, 75, 255, 0.5);
  }
  .gallery-box h4 { color: orange; }
  .gallery-box p { color: orange; }
  .gallery-box span { color: #6495ED; }
}

/* Light mode */
@media screen and (prefers-color-scheme: light) {
  .gallery-item {
    background-color: #f7f7f7;
    border: 2px solid #040273;
    color: black;
  }
  .gallery-item:hover {
    box-shadow: 0 8px 20px rgba(0, 4, 115, 0.5);
  }
  .gallery-box h4 { color: #040273; }
  .gallery-box p { color: black; }
  .gallery-box span { color: #334BFF; }
}

/* Responsive */
@media (max-width: 900px) {
  .gallery-item { flex: 1 1 calc(50% - 20px); }
}
@media (max-width: 500px) {
  .gallery-item { flex: 1 1 100%; }
}

  </style>
</head>

<body>

<!-- Banner for Old List (commented out) -->
<div id="update-banner" style="background: #6495ED; color: black; text-align: center; padding: 10px; border-radius: 15px; display: none;">
  <p>We've changed how the project list works! <a href="other/old/project-list.html">Click here for the old version.</a></p>
  <button onclick="hideBanner()">Don't Show Again</button>
</div>

<script>
  if (!localStorage.getItem("hideBanner")) {
    document.getElementById("update-banner").style.display = "block";
  }

  function hideBanner() {
    document.getElementById("update-banner").style.display = "none";
    localStorage.setItem("hideBanner", "true");
  }
</script>

<p>hello, this is the project list</p>
<p>it is to show projects</p>

<!-- Sorting Dropdown -->
<label for="sort-options">Sort by:</label>
<select id="sort-options" onchange="sortProjects()">
  <option value="last_updated">Last Updated</option>
  <option value="alphabetical">Alphabetical</option>
</select>

<!-- Ads Filter Dropdown -->
<label for="ads-filter">Filter by Ads:</label>
<select id="ads-filter" onchange="filterByAds()">
  <option value="all">All Projects</option>
  <option value="true">Has Ads</option>
  <option value="false">No Ads</option>
</select>

<!-- Gallery Toggle -->
<label>
  <input type="checkbox" id="gallery-toggle" onchange="toggleGallery()"> Gallery View
</label>

<!-- Projects Container -->
<div id="projects-list"></div>

<script>
let projectsData = [];
let filteredProjects = [];

// Fetch projects
fetch('projects.json?t=' + Date.now())
  .then(response => {
    if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
    return response.json();
  })
  .then(data => {
    projectsData = flattenProjects(data.projects);
    filteredProjects = [...projectsData];
    sortProjects();
  })
  .catch(error => {
    console.error("Error loading projects.json:", error);
    alert("Failed to load projects. Please try again later.");
  });

// Flatten nested structure
function flattenProjects(authors) {
  let allProjects = [];
  authors.forEach(author => {
    author.projects.forEach(project => {
      allProjects.push({
        author: author.author,
        name: project.name,
        description: project.description,
        url: project.url,
        last_updated: project.last_updated,
        HasAds: project.HasAds || false
      });
    });
  });
  return allProjects;
}

function sortProjects() {
  if (filteredProjects.length === 0) return;
  const sortBy = document.getElementById("sort-options").value;
  let sortedProjects = [...filteredProjects];

  if (sortBy === "last_updated") {
    sortedProjects.sort((a, b) => new Date(b.last_updated) - new Date(a.last_updated));
  } else if (sortBy === "alphabetical") {
    sortedProjects.sort((a, b) => a.name.localeCompare(b.name));
  }

  displayProjects(sortedProjects);
}

function filterByAds() {
  const adsFilter = document.getElementById("ads-filter").value;
  if (adsFilter === "all") filteredProjects = [...projectsData];
  else if (adsFilter === "true") filteredProjects = projectsData.filter(p => p.HasAds === true);
  else if (adsFilter === "false") filteredProjects = projectsData.filter(p => p.HasAds === false);

  sortProjects();
}

function toggleGallery() {
  sortProjects(); // re-render projects
}

function displayProjects(projects) {
  let container = document.getElementById('projects-list');
  container.innerHTML = "";

  const galleryOn = document.getElementById('gallery-toggle').checked;
  container.className = galleryOn ? "gallery" : "";

  if (projects.length === 0) {
    container.innerHTML = "<p>No projects available at the moment.</p>";
    return;
  }

  let currentAuthor = "";
  projects.forEach(project => {
    if (!galleryOn) {
      if (currentAuthor !== project.author) {
        currentAuthor = project.author;
        container.innerHTML += `<hr><a href="/users/${project.author}.html"><h2>${project.author}</h2></a><hr>`;
      }
      let projectDiv = document.createElement('div');
      projectDiv.innerHTML = `
        <a href="${project.url}">
          <h4>${project.name}</h4>
        </a>
        <p>${project.description}</p>
      `;
      container.appendChild(projectDiv);
    } else {
      // Gallery mode
      let projectDiv = document.createElement('div');
      projectDiv.className = 'gallery-item';
      projectDiv.innerHTML = `
        <a href="${project.url}">
          <div class="gallery-box">
            <h4>${project.name}</h4>
            <p>${project.description}</p>
            <span>${project.author}</span>
          </div>
        </a>
      `;
      container.appendChild(projectDiv);
    }
  });
}
</script>

</body>
</html>
